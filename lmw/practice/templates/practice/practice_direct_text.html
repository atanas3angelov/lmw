{% extends "dictionary/base.html" %}

{% block title %} Practice {% endblock %}

{% block content %}

<script type="text/javascript">
    {% if answer %}
    window.onload = function() {
        document.getElementById("next").focus();
    }
    {% else %}
    window.onload = function() {
        document.getElementById("answer").focus();

        try {
            document.getElementById("answer")
                .addEventListener("keyup", function(event) {
                    playAudio("audio");
                    if (this.value != '') {
                        document.getElementById("check_answer").disabled = false;
                    }
            });
        } catch (err) {}
    }
    {% endif %}

    function playAudio(audio_id) {
        audio = document.getElementById(audio_id);
        if (!!audio) audio.play().catch(err => {console.warn('not allowed to play audio')});
    }
    function endPractice() {
        var end_input = document.createElement("input");
        end_input.setAttribute("type", "hidden");
        end_input.setAttribute("name", "end");
        end_input.setAttribute("value", "End");

        var form = document.getElementById('form_pane');
        form.appendChild(end_input);

        form.submit();
    }
</script>

<style>
    #form_pane {
        width: 400px;
        height: 300px;
    }
    #practice_pane {
        padding-top: 10%;
    }
    #answer{
        display: block;
    }
    .control {
        float: right;
    }
    .correct {
        color: green;
    }
    .incorrect {
        color: red;
    }
</style>

{% load static %}

<form id="form_pane" action="{% url 'practice:practice' lang=lang %}" method="post">

    <div class="control">
        <input type="button" value="End" onclick="endPractice()" />
    </div>

    <div id="practice_pane">
        {% if word.pronunciation and word.pronunciation|slice:'-3:' == 'mp3' %}
            <audio id="audio">
                <source src="{% static 'dictionary/files/' %}{{ word.pronunciation }}" type="audio/mpeg">
            </audio>
            <button type="button" onclick="playAudio('audio')">
                <img src="{% static 'dictionary/audio.jpg' %}" height="10">
            </button>
        {% endif %}

        <label>{{ word.word_text }}</label>
        {% if answer %}
        <input id="answer" type="text" value="{{ answer }}" disabled>
        <input id="next" type="submit" value="Next">
        {% else %}
        <input id="answer" type="text" name="answer" autocomplete="off">
        <input id="check_answer" type="submit" value="Check answer" disabled>
        {% endif %}
    </div>

    {% if answer %}
    <p class="{{ message }}">{{ message }}</p>
    <p class="{{ message }}">{{ message_additional }}</p>
    {% endif %}

    {% csrf_token %}
</form>

{% endblock %}